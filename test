#!/usr/bin/env python2

import re
from os import path
from subprocess import check_output, CalledProcessError
from unittest import main, TestCase

root = path.join(path.dirname(__file__))


class TestsTestCase(TestCase):

    def test_001_first_move(self):
        self.assert_move([112], """
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """)

    def test_001_002(self):
        self.assert_move([4], """
            x x x x . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """)

    def test_001_003(self):
        self.assert_move([0, 4], """
            . x x x . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """)

    def test_001_004(self):
        self.assert_move([0, 4], """
            . o o o . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, 'o')

    def test_001_005(self):
        self.assert_move([10], """
            . . . . . . . . . . . x x x x
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """)

    def test_001_006(self):
        self.assert_move([10], """
            . . . . . . . . . . . o o o o
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, 'o')

    def test_001_007(self):
        self.assert_move([0], """
            . o o o o x . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, 'o')

    def test_001_008(self):
        self.assert_move([8 * 15 + 3], """
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . x . . . . . . . . .
            . . . . . o x . . . . . . . .
            . . . . . . x o . . . . . . .
            . . . . . . o x o . . . . . .
            . . o . . x o x x x o . . . .
            . . . . . x o o o o x x . . .
            . . . . o . x o x o . . . . .
            . . . . x o o o x x . . . . .
            . . . . . x o o . . . . . . .
            . . . . . . . x x . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, 'x')

    def test_001_009(self):
        self.assert_move([4 * 15 + 4], """
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . x . . . . . . . . . . .
            . . . . . o . . . . . . . . .
            . . . . . x . . . . . . . . .
            . . . . . . x . . . . . . . .
            . . . . . . . x . . . . . . .
            . . . . . . . o o . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, 'o')

    def test_002(self):
        self.assert_threats([4], """
            x x x x . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, 'xxxx.', '....m')

    def test_003(self):
        self.assert_threats([5], """
            . x x x x . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, 'xxxx.', '....m')

    def test_004(self):
        self.assert_threats([13], """
            . . . . . . . . . x x x x . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, 'xxxx.', '....m')

    def test_004bis(self):
        self.assert_threats([14], """
            . . . . . . . . . . x x x x .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, 'xxxx.', '....m')

    def test_005(self):
        self.assert_threats([4, 14], """
            x x x x . . . . . . x x x x .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, 'xxxx.', '....m')

    def test_006(self):
        self.assert_threats([14, 19, 199], """
            . . . . . . . . . . x x x x .
            x x x x . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            x x x x . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, 'xxxx.', '....m')

    def test_007(self):
        self.assert_threats([14, 19, 199, 214], """
            . . . . . . . . . . x x x x .
            x x x x . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            x x x x . . . . . . . . . . .
            x x x x . . . . . . . . . . .
        """, 'xxxx.', '....m')

    def test_008(self):
        self.assert_threats([14, 19, 199, 214], """
            . . . . . . . . . . x x x x .
            x x x x . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            x x x x . . . . . . . . . . .
            x x x x . . . . . . . . . . .
        """, 'xxxx.', '....m')

    def test_009(self):
        self.assert_threats([4 * 15], """
            x . . . . . . . . . . . . . .
            x . . . . . . . . . . . . . .
            x . . . . . . . . . . . . . .
            x . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, 'xxxx.', '....m')

    def test_010(self):
        self.assert_threats([5 * 15], """
            . . . . . . . . . . . . . . .
            x . . . . . . . . . . . . . .
            x . . . . . . . . . . . . . .
            x . . . . . . . . . . . . . .
            x . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, 'xxxx.', '....m')

    def test_011(self):
        self.assert_threats([5 * 15, 13 * 15], """
            . . . . . . . . . . . . . . .
            x . . . . . . . . . . . . . .
            x . . . . . . . . . . . . . .
            x . . . . . . . . . . . . . .
            x . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            x . . . . . . . . . . . . . .
            x . . . . . . . . . . . . . .
            x . . . . . . . . . . . . . .
            x . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, 'xxxx.', '....m')

    def test_011bis(self):
        self.assert_threats([4 * 15 + 14], """
            . . . . . . . . . . . . . . x
            . . . . . . . . . . . . . . x
            . . . . . . . . . . . . . . x
            . . . . . . . . . . . . . . x
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, 'xxxx.', '....m')

    def test_012(self):
        self.assert_threats([5 * 15 + 14], """
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . x
            . . . . . . . . . . . . . . x
            . . . . . . . . . . . . . . x
            . . . . . . . . . . . . . . x
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, 'xxxx.', '....m')

    def test_013(self):
        self.assert_threats([5 * 15 + 14, 14 * 15 + 14], """
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . x
            . . . . . . . . . . . . . . x
            . . . . . . . . . . . . . . x
            . . . . . . . . . . . . . . x
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . x
            . . . . . . . . . . . . . . x
            . . . . . . . . . . . . . . x
            . . . . . . . . . . . . . . x
            . . . . . . . . . . . . . . .
        """, 'xxxx.', '....m')

    def test_014(self):
        self.assert_threats([4, 5 * 15 + 14, 14 * 15 + 14], """
            x x x x . . . . . . . . . . .
            . . . . . . . . . . . . . . x
            . . . . . . . . . . . . . . x
            . . . . . . . . . . . . . . x
            . . . . . . . . . . . . . . x
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . x
            . . . . . . . . . . . . . . x
            . . . . . . . . . . . . . . x
            . . . . . . . . . . . . . . x
            . . . . . . . . . . . . . . .
        """, 'xxxx.', '....m')

    def test_015(self):
        self.assert_threats([4, 4 * 15 + 4], """
            x x x x . . . . . . . . . . .
            . x . . . . . . . . . . . . .
            . . x . . . . . . . . . . . .
            . . . x . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, 'xxxx.', '....m')

    def test_016(self):
        self.assert_threats([5 * 15 + 5], """
            . . . . . . . . . . . . . . .
            . x . . . . . . . . . . . . .
            . . x . . . . . . . . . . . .
            . . . x . . . . . . . . . . .
            . . . . x . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, 'xxxx.', '....m')

    def test_016bis(self):
        self.assert_threats([5 * 15 + 5, 14 * 15 + 4], """
            . . . . . . . . . . . . . . .
            . x . . . . . . . . . . . . .
            . . x . . . . . . . . . . . .
            . . . x . . . . . . . . . . .
            . . . . x . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            x . . . . . . . . . . . . . .
            . x . . . . . . . . . . . . .
            . . x . . . . . . . . . . . .
            . . . x . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, 'xxxx.', '....m')

    def test_017(self):
        self.assert_threats([14 * 15 + 14], """
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . x . . . .
            . . . . . . . . . . . x . . .
            . . . . . . . . . . . . x . .
            . . . . . . . . . . . . . x .
            . . . . . . . . . . . . . . .
        """, 'xxxx.', '....m')

    def test_018(self):
        self.assert_threats([12 * 15 + 8], """
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . x . . . . . . . . . .
            . . . . . x . . . . . . . . .
            . . . . . . x . . . . . . . .
            . . . . . . . x . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, 'xxxx.', '....m')

    def test_019(self):
        self.assert_threats([4 * 15 + 10, 14 * 15], """
            . . . . . . . . . . . . . . x
            . . . . . . . . . . . . . x .
            . . . . . . . . . . . . x . .
            . . . . . . . . . . . x . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . x . . . . . . . . . .
            . . . x . . . . . . . . . . .
            . . x . . . . . . . . . . . .
            . x . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, 'xxxx.', '....m')

    def test_020(self):
        self.assert_threats([14 * 15 + 10], """
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . x
            . . . . . . . . . . . . . x .
            . . . . . . . . . . . . x . .
            . . . . . . . . . . . x . . .
            . . . . . . . . . . . . . . .
        """, 'xxxx.', '....m')

    def test_021(self):
        self.assert_threats([4 * 15 + 5], """
            . x . . . . . . . . . . . . .
            . . x . . . . . . . . . . . .
            . . . x . . . . . . . . . . .
            . . . . x . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, 'xxxx.', '....m')

    def test_022(self):
        self.assert_threats([4 * 15 + 5, 4 * 15 + 14], """
            . x . . . . . . . . x . . . .
            . . x . . . . . . . . x . . .
            . . . x . . . . . . . . x . .
            . . . . x . . . . . . . . x .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, 'xxxx.', '....m')

    def test_023(self):
        self.assert_threats([4 * 15 + 5, 13 * 15 + 14], """
            . x . . . . . . . . . . . . .
            . . x . . . . . . . . . . . .
            . . . x . . . . . . . . . . .
            . . . . x . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . x . . . .
            . . . . . . . . . . . x . . .
            . . . . . . . . . . . . x . .
            . . . . . . . . . . . . . x .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, 'xxxx.', '....m')

    def test_024(self):
        self.assert_threats([4 * 15 + 9], """
            . . . . . . . . . . . . . x .
            . . . . . . . . . . . . x . .
            . . . . . . . . . . . x . . .
            . . . . . . . . . . x . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, 'xxxx.', '....m')

    def test_025(self):
        self.assert_threats([4 * 15 + 9, 13 * 15 + 0], """
            . . . . . . . . . . . . . x .
            . . . . . . . . . . . . x . .
            . . . . . . . . . . . x . . .
            . . . . . . . . . . x . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . x . . . . . . . . . .
            . . . x . . . . . . . . . . .
            . . x . . . . . . . . . . . .
            . x . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, 'xxxx.', '....m')

    def test_026(self):
        self.assert_threats([0, 4], """
            . x x x . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, '.xxx.', 'm...m')

    def test_won_x(self):
        won = get_output('won', compact("""
            . x x x x x . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """)).strip()
        self.assertEqual('x', won)

    def test_won_o(self):
        won = get_output('won', compact("""
            . o o o o o . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """)).strip()
        self.assertEqual('o', won)

    def test_won_none(self):
        won = get_output('won', compact("""
            . o o . o o . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """)).strip()
        self.assertEqual('.', won)

    def test_score_001(self):
        self.assert_score(100211, """
            . x x x . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, 'x')

    def test_score_001(self):
        self.assert_score(-5172, """
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . x . . . . . . . . .
            . . . . . o x . . . . . . . .
            . . . . . . x o . . . . . . .
            . . . . . . o x o . . . . . .
            . . o . . x o x x x o . . . .
            . . . x . x o o o o x x . . .
            . . . . o . x o x o . . . . .
            . . . . x o o o x x . . . . .
            . . . . . x o o . . . . . . .
            . . . . . . . x x . . . . . .
            . . . . . . . . . . . . . . .
            . . . . . . . . . . . . . . .
        """, 'o')

    def assert_move(self, expected, board, player='x'):
        self.assert_command(expected, 'play', compact(board), player)

    def assert_threats(self, expected, board, pattern, mask):
        self.assert_command(expected, 'threats', compact(board), pattern, mask)

    def assert_score(self, expected, board, player):
        self.assert_command(expected, 'score', compact(board), player)

    def assert_command(self, expected, *args):
        try:
            output = get_output(*args).strip()
            numbers = map(int, output.split(' ')) if output else []
            self.assertEqual(expected, numbers)
        except:
            print 'output: <<<%s>>>' % output
            raise


def get_output(*args):
    full_args = [path.join(root, 'coaie')] + list(args)
    try:
        return check_output(full_args)
    except CalledProcessError as e:
        print '-' * 100
        print 'args: ', full_args
        print 'out: ', e.output


def compact(s):
    return re.sub(r'\s+', '', s)


if __name__ == '__main__':
    main()
